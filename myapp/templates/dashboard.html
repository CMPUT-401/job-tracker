{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
</head>
<body>
    <header>
        <div class="header-right">
            <button class="ai-button" onclick="openPopupAI()">AI Tailor</button>
            <span>Welcome, User!</span>
            <button class="logout-button">Logout</button>
        </div>
    </header>
    <main>
        <h1>Dashboard</h1>
        <h2>Job Applications</h2>
        <button class="add-button" onclick="openPopup()">Add Application</button>
        <table>
            <thead>
                <tr>
                    <th>Company</th>
                    <th>Position</th>
                    <th>Status</th>
                    <th>Deadline</th>
                    <th>Date Applied</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for application in applications %}
                <tr>
                    <td>{{ application.company }}</td>
                    <td>{{ application.position }}</td>
                    <td>{{ application.status }}</td>
                    <td>{{ application.deadline }}</td>
                    <td>{{ application.date_applied }}</td>
                    <td>{{ application.notes }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>

    <!-- Popup Form -->
    <div id="popup-form" class="popup" style="display: none;">
        <div class="popup-content">
            <h2>Add New Application</h2>
            <form method="post" action="{% url 'add_application' %}">
                {% csrf_token %}
                <label for="company">Company:</label>
                <input type="text" id="company" name="company" required>
                
                <label for="position">Position:</label>
                <input type="text" id="position" name="position" required>
                
                <label for="status">Status:</label>
                <select id="status" name="status" required>
                    <option value="Yet to Apply">Yet to Apply</option>
                    <option value="Applied">Applied</option>
                    <option value="Interview Offer">Interview Offer</option>
                    <option value="Interview Completed">Interview Completed</option>
                    <option value="Offered">Offered</option>
                    <option value="Rejected">Rejected</option>
                </select>
                
                <label for="deadline">Deadline:</label>
                <input type="date" id="deadline" name="deadline" required>
                
                <label for="date_applied">Date Applied:</label>
                <input type="date" id="date_applied" name="date_applied">
                
                <label for="notes">Notes:</label>
                <textarea id="notes" name="notes"></textarea>
                
                <button type="submit" class="submit-button">Add</button>
                <button type="button" class="cancel-button" onclick="closePopup()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Popup Form -->
    <div id="popup-ai" class="popup-ai" style="display: none;">
        <div class="popup-content">
            <h2>Jobscan</h2>
                <h3>Job Description</h3>
                <input id="Job-description" name="Paste Job Description..." required>
                <button type="button"  class="cancel-button" onclick="submitText()">Generate keywords</button>
                <button type="button" class="cancel-button" onclick="closePopupAI()">Cancel</button>
            
            </form>
         
            <h2>Extracted Keywords:</h2>
            <ul id="keywords-list"></ul>
        </div>
        
    </div>

    

    <script>
        function openPopup() {
            document.getElementById("popup-form").style.display = "block";
        }

        function closePopup() {
            document.getElementById("popup-form").style.display = "none";
        }

        function openPopupAI() {
            document.getElementById("popup-ai").style.display = "block";
        }

        function closePopupAI() {
            document.querySelector('#Job-description').value = ''; // Clear the input field
            document.getElementById("popup-ai").style.display = "none";

            document.getElementById('keywords-list').innerHTML = ''; // Clear the content of the div

        }

        function submitText() {
            const userText = document.getElementById("Job-description").value;

            if (userText.trim()) {
                // Make an AJAX POST request to extract keywords
                fetch("{% url 'extract_keywords' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
                    },
                    body: "text=" + encodeURIComponent(userText)
                })
                .then(response => response.json())
                .then(data => {
                    // Show extracted keywords
                    const keywordsList = document.getElementById("keywords-list");
                    keywordsList.innerHTML = "";  // Clear existing list
                    data.keywords.forEach(keyword => {
                        const li = document.createElement("li");
                        li.textContent = `${keyword[0]} (Frequency: ${keyword[1]})`;
                        keywordsList.appendChild(li);
                    });

                    // Close the popup
                    closePopup();
                })
                .catch(error => console.error("Error:", error));
            } else {
                alert("Please enter some text!");
            }
        }

        
    </script>
</body>
</html>